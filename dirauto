#!/bin/bash

#================================================================
# HEADER
#================================================================
# Script Name   : dirauto
# Description   : Customizable directory scan that enumerates 
# 		:  subdomain through content-discovery
# Author        : Eliaz Simon
# Date          : <INSERT DATE HERE>
# Version       : 1.0
# Usage         : ./dirauto -i <target_host>
# Notes         : Ensure you install all tools to use this script
# Dependencies  : See README.md for more info on installation
#================================================================
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.
#================================================================

###############################################################
# ANSI Color Code Escape Sequences			      #
###############################################################
BLACK="\e[30m"
RED="\e[31m"
GREEN="\e[32m"
YELLOW="\e[33m"
BLUE="\e[34m"
MAGENTA="\e[35m"
CYAN="\e[36m"
LIGHT_GRAY="\e[37m"
GRAY="\e[90m"
LIGHT_RED="\e[91m"
LIGHT_GREEN="\e[92m"
LIGHT_YELLOW="\e[93m"
LIGHT_BLUE="\e[94m"
LIGHT_MAGENTA="\e[95m"
LIGHT_CYAN="\e[96m"
WHITE="\e[97m"
ENDCOLOR="\e[0m"

# Background Color
BLACK_BG="\e[40m"
RED_BG="\e[41m"
GREEN_BG="\e[42m"
YELLOW_BG="\e[43m"
BLUE_BG="\e[44m"
MAGENTA_BG="\e[45m"
CYAN_BG="\e[46m"
WHITE_BG="\e[47m"

# Styles
BOLD="\e[1m"
ITALIC="\e[3m"

# Banner
echo "
┳┓•  ┏┓     
┃┃┓┏┓┣┫┓┏╋┏┓
┻┛┗┛ ┛┗┗┻┗┗┛
"

#================================================================
# FUNCTION: info
# DESCRIPTION:
#     Prints info message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
info() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${GREEN}INFO${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}$1${ENDCOLOR}\n"
}

#================================================================
# FUNCTION: important_info
# DESCRIPTION:
#     Prints important info message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
important_info() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${BOLD_GREEN}INFO${ENDCOLOR}${WHITE}]${ENDCOLOR} ${BOLD_WHITE}$1${ENDCOLOR}\n"
}

#================================================================
# FUNCTION: success
# DESCRIPTION:
#     Prints success message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
success() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${BOLD_GREEN}SUCCESS${ENDCOLOR}${WHITE}]${ENDCOLOR} ${BOLD_WHITE}$1${ENDCOLOR}\n"
}

#================================================================
# FUNCTION: warning
# DESCRIPTION:
#     Prints warning message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
warning() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${YELLOW}WARNING${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}$1${ENDCOLOR}\n"
}

#================================================================
# FUNCTION: important_warning
# DESCRIPTION:
#     Prints important warning message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
important_warning() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${BOLD_YELLOW}WARNING${ENDCOLOR}${WHITE}]${ENDCOLOR} ${BOLD_WHITE}$1${ENDCOLOR}\n"
}

#================================================================
# FUNCTION: print_usage
# DESCRIPTION:
#     Prints error message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
error() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}$1${ENDCOLOR}\n"
}

#================================================================
# FUNCTION: print_usage
# DESCRIPTION:
#     Prints important error message using the provided parameter.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
important_error() {
	local message=$1
	printf "${WHITE}[${ENDCOLOR}${CYAN}$current_time${ENDCOLOR}${WHITE}]${ENDCOLOR} ${WHITE}[${ENDCOLOR}${BOLD_RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} ${BOLD_WHITE}$1${ENDCOLOR}\n"
}

###############################################################
# Help & Usage                                                # 
###############################################################
#================================================================
# FUNCTION: usage
# DESCRIPTION:
#     Prints default usage information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
usage() {
        echo "Directory Enumeration Automator with Gobuster, FFuF, Feroxbuster, DirSearch & Dirb"
	echo " "
	echo "Usage: dirauto [modes] [-u, --url] [options]"
	echo " "
}

#================================================================
# FUNCTION: help
# DESCRIPTION:
#     Prints default help information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
help()
{
	usage
        echo "Options:"
       	printf "  ${BOLD}--usage${ENDCOLOR}			Show usage information\n"
        printf "  ${BOLD}-h, --help${ENDCOLOR}			Show help message\n"
        printf "  ${BOLD}-u, --url${ENDCOLOR}			Specify target URL\n"
        printf "  ${BOLD}-x, --extensions${ENDCOLOR}		Specify extensions\n"
        printf "  ${BOLD}-c, --status-codes${ENDCOLOR}		Specify status codes\n"
        printf "  ${BOLD}-e, --extension-rate${ENDCOLOR}		Specify extension rate\n"
        printf "  ${BOLD}-t, --threads${ENDCOLOR}			Specify number of threads\n"
        printf "  ${BOLD}-w, --wordlist${ENDCOLOR}		Specify wordlist\n"
        printf "  ${BOLD}--check${ENDCOLOR}			Check if repositories are installed\n"
        printf "  ${BOLD}-i, --install${ENDCOLOR}			Install repositories\n"
        echo " "
        echo "Modes:"
        printf "  ${BOLD}dir${ENDCOLOR}				Directory Mode\n"
        printf "  ${BOLD}vhost${ENDCOLOR}				Virtual Host Mode\n"
        printf "  ${BOLD}subdomain${ENDCOLOR}			Subdomain Mode\n"
	exit 0
}

#================================================================
# FUNCTION: dir_usage
# DESCRIPTION:
#     Prints directory usage information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
dir_usage() {
        echo "Directory Enumeration Automator with Gobuster, FFuF, Feroxbuster, DirSearch & Dirb"
	echo " "
	echo "Usage: dirauto dir [-u, --url] [modes]"
	echo " "
}

#================================================================
# FUNCTION: dir_help
# DESCRIPTION:
#     Prints directory help information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
dir_help() {
	dir_usage
        echo "Directory mode help:"
       	printf "  ${BOLD}--usage${ENDCOLOR}				Show usage information\n"
        printf "  ${BOLD}-h, --help${ENDCOLOR}				Show help information\n"
        printf "  ${BOLD}-u, --url <URL>${ENDCOLOR}			Specify target URL\n"
        printf "  ${BOLD}-x, --extensions <ext>${ENDCOLOR}		Specify file extensions\n"
        printf "  ${BOLD}-c, --status-codes <codes>${ENDCOLOR}		Specify Status Codes\n"
        printf "  ${BOLD}-t, --threads <threads>${ENDCOLOR}		Specify number of threads\n"
        printf "  ${BOLD}-e, --execution-rate <rate>${ENDCOLOR}		Specify execution rate\n"
        printf "  ${BOLD}-w, --wordlist <file>${ENDCOLOR}			Specify wordlist\n"
        printf "  ${BOLD}--auto${ENDCOLOR}				Enable auto mode\n"
        echo " "
	exit 0
}

#================================================================
# FUNCTION: vhost_usage
# DESCRIPTION:
#     Prints virtual host usage information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
vhost_usage() {
        echo "Directory Enumeration Automator with Gobuster, FFuF, Feroxbuster, DirSearch & Dirb"
	echo " "
	echo "Usage: dirauto vhost [-u, --url] [modes]"
	echo " "
}

#================================================================
# FUNCTION: vhost_help
# DESCRIPTION:
#     Prints virtual host help information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
vhost_help() {
	vhost_usage
        echo "Virtual host mode help:"
       	printf "  ${BOLD}--usage${ENDCOLOR}				Show usage information\n"
        printf "  ${BOLD}-h, --help${ENDCOLOR}				Show help information\n"
        printf "  ${BOLD}-u, --url <URL>${ENDCOLOR}			Specify target URL\n"
        printf "  ${BOLD}-x, --extensions <ext>${ENDCOLOR}		Specify file extensions\n"
        printf "  ${BOLD}-c, --status-codes <codes>${ENDCOLOR}		Specify Status Codes\n"
        printf "  ${BOLD}-t, --threads <threads>${ENDCOLOR}		Specify number of threads\n"
        printf "  ${BOLD}-e, --execution-rate <rate>${ENDCOLOR}		Specify execution rate\n"
        printf "  ${BOLD}-w, --wordlist <file>${ENDCOLOR}			Specify wordlist\n"
        printf "  ${BOLD}--auto${ENDCOLOR}				Enable auto mode\n"
        echo " "
	exit 0
}

#================================================================
# FUNCTION: dns_usage
# DESCRIPTION:
#     Prints DNS / subdomain usage information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
dns_usage() {
        echo "Directory Enumeration Automator with Gobuster, FFuF, Feroxbuster, DirSearch & Dirb"
	echo " "
	echo "Usage: dirauto subdomain [-u, --url] [modes]"
	echo " "
}

#================================================================
# FUNCTION: dns_help
# DESCRIPTION:
#     Prints DNS / subdomain help information.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
dns_help() { 
	dns_usage
        echo "DNS mode help:"
       	printf "  ${BOLD}--usage${ENDCOLOR}			Show usage information\n"
        printf "  ${BOLD}-h, --help${ENDCOLOR}			Show help information\n"
        printf "  ${BOLD}-u, --url${ENDCOLOR}			Specify target URL\n"
        printf "  ${BOLD}-x, --extensions${ENDCOLOR}		Specify file extensions\n"
        printf "  ${BOLD}-c, --status-codes${ENDCOLOR}		Specify status codes\n"
        printf "  ${BOLD}-t, --threads${ENDCOLOR}			Specify number of threads\n"
        printf "  ${BOLD}-e, --execution-rate${ENDCOLOR}		Specify execution rate\n"
        printf "  ${BOLD}-w, --wordlist${ENDCOLOR}		Specify wordlist\n"
        printf "  ${BOLD}--auto${ENDCOLOR}			Enable auto mode\n"
        echo " "
	exit 0
}

# ===========================================================================
# Checking Conditions... 
# ===========================================================================
# ---------------------------------------------------------------------------
# Repositories Check
# ---------------------------------------------------------------------------
#================================================================
# FUNCTION: check
# DESCRIPTION:
#     Checks third-party programs are located in /usr/bin directory.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
check() {
	if ! [-f /usr/bin/gobuster ]; then
		error "Gobuster is not located in /usr/bin. Install Gobuster."
		exit 1
	fi 
	info "Gobuster installed."

	if ! [-f /usr/bin/ffuf ]; then
		error "FFuF is not located in /usr/bin. Install FFuF."
		exit 1
	fi 
	info "FFuF installed."

	if ! [-f /usr/bin/feroxbuster ]; then
		error "FeroxBuster is not located in /usr/bin. Install FeroxBuster."
		exit 1
	fi 
	info "Feroxbuster installed."

	if ! [-f /usr/bin/dirsearch ]; then
		error "Dirsearch is not located in /usr/bin. Install Dirsearch."
		exit 1
	fi 
	info "Dirsearch installed."

	if ! [-f /usr/bin/dirb ]; then
		error "Dirb is not located in /usr/bin. Install Dirb,"
		exit 1
	fi 
	info "Dirb installed."

	if ! [ -d /usr/share/seclists ] || [ -d /usr/share/wordlist/seclists ]; then
		error "Seclists is not located in /usr/share directory. Install Seclists."
		exit 1
	fi 
	info "Seclists installed."

	echo " "

	success "All of the programs are installed for usage. You are ready to enumerate!"

	exit 1
}

###############################################################
# Printing output options...                                  #
###############################################################
#================================================================
# FUNCTION: search_wordlist
# DESCRIPTION:
#     Search the name of wordlist through /usr/share/seclists directory.
# PARAMETERS:
#     $1 - Specified wordlist
# RETURNS:
#     None
#================================================================
search_wordlist() {
	local wordlist_name="$1"

	wordlist_path=$(find /usr/share/seclists -type f -name "$wordlist_name" 2>/dev/null | head -n 1)

    	if [ -n "$wordlist_path" ]; then
		echo $wordlist_path
		return 0
	else 
		return 1
	fi
}

#================================================================
# FUNCTION: input_check
# DESCRIPTION:
#     Checks global variables that are specified before scan
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
input_check() {
	# ---------------------------------------------------------------------------
	# Target URL
	# ---------------------------------------------------------------------------
	if [ -z "$URL" ]; then
		error "Missing URL address. Please specify the URL using the -u or --url option."
		exit 1
	fi

	# ---------------------------------------------------------------------------
	# WORDLIST
	# ---------------------------------------------------------------------------
	if [[ -n "$WORDLIST" ]]; then
		if ! [ -d /usr/share/seclists ] || [ -d /usr/share/wordlist/seclists ]; then
			error "Seclists is not located in /usr/share directory. Install Seclists."
			exit 1
		fi 

		wordlist_path=$(search_wordlist "$WORDLIST")	
		if [ -z "$wordlist_path" ]; then
			error "Wordlist not found"
			exit 1
		fi

		info "Using wordlist: $wordlist_path"

		exit 1
	fi

	# ---------------------------------------------------------------------------
	# EXTENSIONS
	# ---------------------------------------------------------------------------
	if [[ -n "$EXTENSIONS" ]]; then
		if ! [[ $EXTENSIONS =~ ^[a-zA-Z0-9.,]+$ ]]; then
			error "Status codes must not contain any special characters"
			exit 1
		fi	
	fi

	# ---------------------------------------------------------------------------
	# STATUS CODES
	# ---------------------------------------------------------------------------
	if [[ -n "$STATUS_CODES" ]]; then
		if ! [[ $STATUS_CODES =~ ^[0-9]+$ ]]; then
			error "Status codes must contain only integer and the following charater ',' for separation"
			exit 1
		fi	
	fi

	# ---------------------------------------------------------------------------
	# EXECUTION RATE
	# ---------------------------------------------------------------------------
	if [[ -n "$EXECUTION_RATE" ]]; then
		if ! [[ $EXECUTION_RATE =~ ^[0-9]+$ ]]; then
			error "Execution rate must only accept integers"
			exit 1
		fi	
	fi

	# ---------------------------------------------------------------------------
	# THREADS
	# ---------------------------------------------------------------------------
	if [[ -n "$THREADS" ]]; then
		if ! [[ $THREADS =~ ^[0-9]+$ ]]; then
			error "Threads must contain only integers"
			exit 1
		fi	
	fi

	echo " "
	important_info "Target: $URL"

	if [[ -n "$EXTENSIONS" ]]; then
		info "Extensions: $EXTENSIONS"
	fi

	if [[ -n "$THREADS" ]]; then
		info "Threads: $THREADS"
	fi

	if [[ -n "$STATUS_CODES" ]]; then
		info "Status Codes: $STATUS_CODES"
	fi

	if [[ -n "$EXECUTION_RATE" ]]; then
		info "Execution Rate: $EXECUTION_RATE"
	fi

	if [[ -n "$WORDLIST" ]]; then
		info "Wordlist: $WORDLIST"
	fi

	# exit 0
}

###############################################################
# Directory Enumeration Selection Option                      #
###############################################################
#================================================================
# FUNCTION: auto_dir_scan
# DESCRIPTION:
#     Performs automatic directory scan on target URL.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
auto_dir_scan() {
	info "Automatic Directory Enumeration Scan Enabled.."

	mkdir -p Dirauto/dir/Auto/Gobuster
	mkdir -p Dirauto/dir/Auto/Feroxbuster

	info "Started Automatic Directory Enumeration Scan"
	info "Initializing Gobuster..."

	common_path=$(search_wordlist "common.txt")
	if [ -z "$common_path" ]; then
		error "common.txt wordlist not found"
	else
		info "Found common.txt wordlist"
		gobuster dir -u $URL -w $common_path -o $(pwd)/Dirauto/dir/Auto/Gobuster/common.txt
	fi

	#big_path=$(search_wordlist "big.txt")
	#if [ -z "$big_path" ]; then
	#	printf "${WHITE}[${ENDCOLOR}${RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} big.txt wordlist not found\n"
	#else 
	#	printf "${WHITE}[${ENDCOLOR}${GREEN}INFO${ENDCOLOR}${WHITE}]${ENDCOLOR} Found big.txt wordlist\n"
	#	gobuster dir -u $URL -w $big_path -o $(pwd)/Dirauto/dir/Auto/Gobuster/big.txt
	#fi

	#directory_list_small_path=$(search_wordlist "directory-list-2.3-small.txt")
	#if [ -z "$directory_list_small_path" ]; then
	#	printf "${WHITE}[${ENDCOLOR}${RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} directory-list-2.3-small.txt wordlist not found\n"
	#else
	#	printf "${WHITE}[${ENDCOLOR}${GREEN}INFO${ENDCOLOR}${WHITE}]${ENDCOLOR} Found directory-list-2.3-small.txt wordlist\n"
	#	gobuster dir -u $URL -w $directory_list_small_path -o $(pwd)/Dirauto/dir/Auto/Gobuster/dir_small.txt
	#fi

	#directory_list_medium_path=$(search_wordlist "directory-list-2.3-medium.txt")
	#if [ -z "$directory_list_medium_path" ]; then
	#	printf "${WHITE}[${ENDCOLOR}${RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} directory-list-2.3-medium.txt wordlist not found\n"
	#else 
	#	printf "${WHITE}[${ENDCOLOR}${GREEN}INFO${ENDCOLOR}${WHITE}]${ENDCOLOR} Found directory-list-2.3-medium.txt wordlist\n"
	#	gobuster dir -u $URL -w $directory_list_medium_path -o $(pwd)/Dirauto/dir/Auto/Gobuster/dir_medium.txt
	#fi

	echo " "

	raft_medium_directories_path=$(search_wordlist "raft-medium-directories.txt")
	if [ -z "$raft_medium_directories_path" ]; then
		error "raft-medium-directories.txt wordlist not found"
	else 
		info "Found raft-medium-directories.txt wordlist"
		info "Initializing Feroxbuster..."
		feroxbuster -u $URL --output $(pwd)/Dirauto/dir/Auto/Feroxbuster/feroxbuster.txt
	fi

	echo " "

	info "Completed Automatic Directory Enumeration Scan"
}

#================================================================
# FUNCTION: auto_vhost_scan
# DESCRIPTION:
#     Performs automatic vhost scan on target URL.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
auto_vhost_scan() {
	info "Automatic Virtual Host Enumeration Scan Enabled.."

	mkdir -p Dirauto/vhost/Auto/Gobuster
	mkdir -p Dirauto/vhost/Auto/FFuF

	info "Started Automatic Virtual Host Enumeration Scan"
	info "Initializing Gobuster..."

	subdomains_5000_path=$(search_wordlist "subdomains-top1million-5000.txt")
	if [ -z "$subdomains_5000_path" ]; then
		error "subdomains-top1million-5000.txt wordlist not found"
	else
		info "Found subdomains-top1million-5000.txt wordlist"

		gobuster_command="gobuster vhost -u $URL -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt"
		if [ -n "$EXCLUDE_CONTENT_LENGTH" ]; then
			gobuster_command+=" --exclude-length $EXCLUDE_CONTENT_LENGTH"
		fi

		echo "$gobuster_command"
		eval "$gobuster_command"

		echo " "

		# ============================== 

		ffuf_command="ffuf -u $URL -H \"$HOST\" -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -o $(pwd)/Dirauto/vhost/Auto/FFuF/subdomains-top1million-5000.txt"

		if [ -n "$EXCLUDE_CONTENT_LENGTH" ]; then
			ffuf_command+=" -fs $EXCLUDE_CONTENT_LENGTH"
		fi

		printf "${WHITE}[${ENDCOLOR}${GREEN}INFO${ENDCOLOR}${WHITE}]${ENDCOLOR} Initializing FFuF...\n"

		eval "$ffuf_command"
	fi

	echo " "

	info "Completed Automatic Virtual Host Enumeration Scan"

}

#================================================================
# FUNCTION: auto_dns_scan
# DESCRIPTION:
#     Performs DNS scan on target host.
# PARAMETERS:
#     $1 - A message
# RETURNS:
#     None
#================================================================
auto_dns_scan() {
	info "Automatic DNS Enumeration Scan Enabled.."

	mkdir -p Dirauto/dns/Auto/dig
	mkdir -p Dirauto/dns/Auto/Gobuster

	info "Started Automatic DNS Enumeration Scan"
	info "Gathering DNS information from DNS server..."

	if [ -z "$DOMAIN_NAME" ]; then
		error "Domain name is required to gather DNS information"
	else
		dig_command="dig axfr $DOMAIN_NAME @$URL | tee $(pwd)/Dirauto/dns/Auto/dig/dig.txt"	
		echo "$dig_command"
		eval "$dig_command"

		echo " "
	fi	

	info "Initializing Gobuster..."
	subdomains_path=$(search_wordlist "subdomains-top1million-20000.txt")
	if [ -z "$subdomains_path" ]; then
		error "subdomains-top1million-5000.txt wordlist not found"
	else
		info "Found subdomains-top1million-5000.txt wordlist"

		# gobuster_command="gobuster dns -d $DOMAIN_NAME -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-20000.txt -o $(pwd)/Dirauto/dns/Auto/Gobuster/subdomains-top1million-20000.txt"
		gobuster_command="gobuster vhost -u http://$DOMAIN_NAME --append-domain -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -o $(pwd)/Dirauto/dns/Auto/Gobuster/subdomains-top1million-5000.txt"

		echo "$gobuster_command"
		eval "$gobuster_command"
	fi
}

###############################################################
# Enumeration Programs                                        #
###############################################################
#================================================================
# FUNCTION: run_gobuster
# DESCRIPTION:
#     Performs selected enumeration scan using GoBuster.
# PARAMETERS:
#     $1 - Specified option scan
#     $2 - Specified extension
#     $3 - Specified response codes
#     $4 - Specified execution rate
# RETURNS:
#     None
#================================================================
run_gobuster() {
	local OPTION="$1"

	if [ "$OPTION" == "dir" ]; then
		local url="$2"
		local extension="$4"
		local response_codes="$5"
		local execution_rate="$6"

		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="gobuster dir -u $url -w $wordlist -o $(pwd)/Dirauto/dir/Gobuster/$wordlist.txt"

			if [ -n "$extension" ]; then
				if [[ $extension =~ *[[:alpha:]]* ]] && [[ $extension =~ *[[:digit:]]* ]]; then
					command+=" -x $extension"	
				fi
			fi
			
			if [ -n "$response_codes" ]; then
				if [[ $response_codes =~ *[[:alpha:]]* ]] && [[ $response_codes =~ *[[:digit:]]* ]]; then
					command+=" -s $response_codes"	
				fi
			fi

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"	
				fi
			fi

			eval "$command"
		done
	fi

	if [ "$OPTION" == "vhost" ]; then
		local url="$2"
		local execution_rate="$6"

		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="gobuster vhost -u $url -w $wordlist -o $(pwd)/Dirauto/vhost/Gobuster/$wordlist.txt"

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"	
				fi
			fi

			eval "$command"
		done
	fi

	if [ "$OPTION" == "dns" ]; then
		local url="$2"
		local execution_rate="$6"
	
		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="gobuster dns -d $url -w $wordlist -i -o $(pwd)/Dirauto/subdomain/Gobuster/$wordlist.txt"

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"	
				fi
			fi

			eval "$command"
		done
	fi 

	if [ -z "$OPTION" ]; then
		printf "${WHITE}[${ENDCOLOR}${RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} Option mode has not been selected\n"
	fi
}

#================================================================
# FUNCTION: run_FFuF
# DESCRIPTION:
#     Performs selected enumeration scan using FFuF.
# PARAMETERS:
#     $1 - Specified option scan
#     $2 - Specified target URL
#     $3 - Specified extension 
#     $4 - Specified resposne codes
#     $5 - Specified execution rate
# RETURNS:
#     None
#================================================================
run_FFuF() {
	local OPTION="$1"

	if [ "$OPTION" == "dir" ]; then
		local url="$2"
		local extension="$4"
		local response_codes="$5"
		local execution_rate="$6"
		
		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="ffuf -c -w $wordlist -u $url/FUZZ -o $(pwd)/Dirauto/dir/FFuF/$wordlist.txt"
			
			if [ -n "$extension" ]; then
				if [[ $extension =~ *[[:alpha:]]* ]] && [[ $extension =~ *[[:digit:]]* ]]; then
					command+=" -e $extension"
				fi
			fi 

			if [ -n "$response_codes" ]; then
				if [[ $response_codes =~ *[[:alpha:]]* ]] && [[ $response_codes =~ *[[:digit:]]* ]]; then
					command+=" -mc $response_codes"
				fi
			fi 

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"
				fi
			fi 
			
			eval "$command"
		done
	fi
	
	if [ "$OPTION" == "vhost" ]; then
		local url="$2"
		local execution_rate="$6"

		echo "Enter the name of the header for FUZZING (Example: \"Host: FUZZ.ffuf.com \"): "	
		read headerInput

		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="ffuf -c -w $wordlist -H \"$headerInput\" -u $url -o $(pwd)/Dirauto/vhost/FFuF/$wordlist.txt"

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"
				fi
			fi 

			eval "$command"
		done
	fi

	if [ "$OPTION" == "dns" ]; then
		local url="$2"
		local execution_rate="$6"

		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="ffuf -c -w $wordlist -u $url -H \"Host: FUZZ\" -o $(pwd)/Dirauto/subdomain/FFuF/$wordlist.txt"
		
			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"
				fi
			fi 

			eval "$command"
		done
	fi 

	if [ -z "$OPTION" ]; then
		printf "${WHITE}[${ENDCOLOR}${RED}ERROR${ENDCOLOR}${WHITE}]${ENDCOLOR} Option mode has not been selected\n"
	fi
}

#================================================================
# FUNCTION: run_dirsearch
# DESCRIPTION:
#     Performs selected enumeration scan using DirSearch.
# PARAMETERS:
#     $1 - Specified option scan
#     $2 - Specified target URL
#     $3 - Specified extension
#     $4 - Specified response codes
#     $5 - Specified execution rate
# RETURNS:
#     None
#================================================================
run_dirsearch() {
	local OPTION="$1"

	if [ "$OPTION" == "dir" ]; then
		local url="$2"
		local extension="$4"
		local response_codes="$5"
		local execution_rate="$6"

		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="dirsearch -u $url -o $(pwd)/Dirauto/dir/Dirsearch/$wordlist.txt"

			if [ -n "$extension" ]; then
				if [[ $extension =~ *[[:alpha:]]* ]] && [[ $extension =~ *[[:digit:]]* ]]; then
					command+=" -e $extension"
				fi
			fi 

			if [ -n "$response_codes" ]; then
				if [[ $response_codes =~ *[[:alpha:]]* ]] && [[ $response_codes =~ *[[:digit:]]* ]]; then
					command+=" -i $response_codes"
				fi
			fi 

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"
				fi
			fi 

			eval "$command"
		done
	fi 

	if [ -z "$OPTION" ]; then
		error "Option mode has not been selected"
	fi
	
}

#================================================================
# FUNCTION: run_feroxbuster
# DESCRIPTION:
#     Performs selected enumeration scan using FeroxBuster.
# PARAMETERS:
#     $1 - Specified option scan
#     $2 - Specified target URL
#     $3 - Specified extension
#     $4 - Specified response codes  
#     $5 - Specified execution rate
# RETURNS:
#     None
#================================================================
run_feroxbuster() {
	local OPTION="$1"

	if [ "$OPTION" == "dir" ]; then
		local url="$2"
		local extension="$4"
		local response_codes="$5"
		local execution_rate="$6"
		
		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="feroxbuster --url $url --wordlist $(pwd)/Dirauto/dir/Feroxbuster/$wordlist"	

			if [ -n "$extension" ]; then
				if [[ $extension =~ *[[:alpha:]]* ]] && [[ $extension =~ *[[:digit:]]* ]]; then
					command+=" -x $extension"
				fi
			fi 

			if [ -n "$execution_rate" ]; then
				if [[ $execution_rate =~ *[[:digit:]]* ]]; then
					command+=" -t $execution_rate"
				fi
			fi 

			eval "$command"
		done
	fi 

	if [ -z "$OPTION" ]; then
		error "Option mode has not been selected"
	fi
}

#================================================================
# FUNCTION: info
# DESCRIPTION:
#     Performs selected enumeration scan using FeroxBuster.
# PARAMETERS:
#     $1 - Specified option scan
#     $2 - Specified target URL
#     $3 - Specified extension
# RETURNS:
#     None
#================================================================
run_dirb() {
	local OPTION="$1"

	if [ "$OPTION" == "dir" ]; then
		local url="$2"
		local extension="$4"

		IFS=";" read -r -a FILES <<< "$WORDLISTS"
		for wordlist in ${FILES[@]}; do
			command="dirb $url -o $(pwd)/Dirauto/dir/Dirb/$wordlist.txt"

			if [ -n "$extension" ]; then
				if [[ $extension =~ *[[:alpha:]]* ]] && [[ $extension =~ *[[:digit:]]* ]]; then
					command+=" -X $extension"
				fi
			fi 

			eval "$command"
		done
	fi 

	if [ -z "$OPTION" ]; then
		error "Option mode has not been selected"
	fi
}

# ---------------------------------------------------------------------------
# MODES
# ---------------------------------------------------------------------------
# ---------------------------------------------------------------------------
# Directory Mode
# ---------------------------------------------------------------------------
#================================================================
# FUNCTION: dir_mode
# DESCRIPTION:
#     Processes parameters in directory mode.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
dir_mode() {
	while [[ "$#" -gt 0 ]]; do
		case $1 in
			-h|--help) dir_help ;;
			--usage) dir_usage ;;
			-u|--url) URL="$2"; shift ;;
			gb) $GOBUSTER=true; shift ;;
			ff) $FFUF=true; shift ;;
			fb) $FEROXBUSTER=true; shift ;;
			ds) $DIRSEARCH=true; shift ;;
			db) $DIRB=true; shift ;;
			-x|--extensions) $EXTENSIONS="$2"; shift ;;
			-c|--status-codes) $STATUS_CODES="$2"; shift ;;
			-t|--threads) $THREADS="$2"; shift ;;
			-w|--wordlist) $WORDLIST="$2"; shift ;;
			--auto) AUTO=true; shift ;; 
			*) error "Unknown Paramter Passed: $1"; exist 1 ;;
		esac
		shift
	done

	input_check

	OPTION="dir"

	info "Initialized Directory Mode"

	if [ "$AUTO" == "true" ]; then
		automatic_dir_scan
		SCANNED=="true"
	fi

	if [ "$GOBUSTER" == "true" ]; then
		run_gobuster "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
		SCANNED=="true"
	fi

	if [ "$FFUF" == "true" ]; then
		run_FFuF "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
		SCANNED=="true"
	fi

	if [ "$DIRSEARCH" == "true" ]; then
		run_dirsearch "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
		SCANNED=="true"
	fi

	if [ "$FEROXBUSTER" == "true" ]; then
		run_feroxbuster "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
		SCANNED=="true"
	fi

	if [ "$DIRB" == "true" ]; then
		run_dirb "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
		SCANNED=="true"
	fi

	if ! [ "$SCANNED" ]; then
		error "You have not selected an enumeration program to perform directory scan."
		exit 1
	fi

	info "Completed Directory Mode"

	exit 0
}

# ---------------------------------------------------------------------------
# Subdomain Mode
# ---------------------------------------------------------------------------
#================================================================
# FUNCTION: dns_mode
# DESCRIPTION:
#     Processes parameters in DNS / Subdomain mode.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
dns_mode() {
	while [[ "$#" -gt 0 ]]; do
		case $1 in
			-h|--help) dns_help ;;
			--usage) dns_usage ;;
			-u|--url) URL="$2"; shift ;;
			gb) $GOBUSTER=true; shift ;;
			ff) $FFUF=true; shift ;;
			fb) $FEROXBUSTER=true; shift ;;
			ds) $DIRSEARCH=true; shift ;;
			db) $DIRB=true; shift ;;
			-x|--extensions) $EXTENSIONS="$2"; shift ;;
			-c|--status-codes) $STATUS_CODES="$2"; shift ;;
			-t|--threads) $THREADS="$2"; shift ;;
			-w|--wordlist) $WORDLIST="$2"; shift ;;
			--auto) AUTO=true ;; 
			-d|--domain)DOMAIN_NAME="$2"; shift ;;
			*) error "Unknown Parameter Passed: $1"; exit 1 ;;
		esac
		shift
	done

	input_check

	OPTION="dns"

	info "Initialized DNS Mode"

	if [ "$AUTO" == "true" ]; then
		automatic_dns_scan
	fi

	if [ "$GOBUSTER" == "true" ]; then
		run_gobuster "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$FFUF" == "true" ]; then
		run_FFuF "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$DIRSEARCH" == "true" ]; then
		run_dirsearch "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$FEROXBUSTER" == "true" ]; then
		run_feroxbuster "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$DIRB" == "true" ]; then
		run_dirb "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	info "Completed Subdomain Mode"

	exit 0
}

# ---------------------------------------------------------------------------
# Virtual Host Mode
# ---------------------------------------------------------------------------
#================================================================
# FUNCTION: vhost_mode
# DESCRIPTION:
#     Processes parameters in virtual host mode.
# PARAMETERS:
#     None
# RETURNS:
#     None
#================================================================
vhost_mode() {
	while [[ "$#" -gt 0 ]]; do
		case $1 in
			-h|--help) vhost_help ;;
			--usage) vhost_usage ;;
			-u|--url) URL="$2"; shift ;;
			gb) $GOBUSTER=true; shift ;;
			ff) $FFUF=true; shift ;;
			fb) $FEROXBUSTER=true; shift ;;
			ds) $DIRSEARCH=true; shift ;;
			db) $DIRB=true; shift ;;
			-x|--extensions) $EXTENSIONS="$2"; shift ;;
			-c|--status-codes) $STATUS_CODES="$2"; shift ;;
			-t|--threads) $THREADS="$2"; shift ;;
			-w|--wordlist) $WORDLIST="$2"; shift ;;
			--auto) AUTO=true ;; 
			-H) HOST="$2"; shift ;;
			-fs) EXCLUDE_CONTENT_LENGTH="$2"; shift ;;
			*) error "Unknown parameter passed: $1"; exit 1 ;;
		esac
		shift
	done

	input_check

	OPTION="vhost"

	info "Initialized VHost Mode"

	if [ "$AUTO" == "true" ]; then
		if [ -z "$HOST" ]; then
			error "Host name empty"
			exit 1
		fi 		

		automatic_vhost_scan
	fi

	if [ "$GOBUSTER" == "true" ]; then
		run_gobuster "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$FFUF" == "true" ]; then
		run_FFuF "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$DIRSEARCH" == "true" ]; then
		run_dirsearch "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$FEROXBUSTER" == "true" ]; then
		run_feroxbuster "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	if [ "$DIRB" == "true" ]; then
		run_dirb "$OPTION" "$URL" "$wordlist" "$EXTENSIONS" "$STATUS_CODES" "$THREADS"
	fi

	info "Completed VHost Mode"

	exit 1
}


###############################################################
# Arguments                                                   #
###############################################################
if [ $# -eq 0 ];
then 
	usage
        exit 1
fi

# Global Arguments
URL=""
EXTENSIONS=""
STATUS_CODES=""
THREADS=""
EXECUTION_RATE=""
WORDLIST=""
GOBUSTER=false
FEROXBUSTER=false
DIRSEARCH=false
DIRB=false
AUTO=false
SCANNED=false

# VHost Arguments
HOST=""
EXCLUDE_CONTENT_LENGTH=""

# DNS Arguments
DOMAIN_name=""

while [[ "$#" -gt 0 ]]; do
	case $1 in
		-h|--help) help ;;
		--usage) usage ;;
		-u|--url) URL="$2"; shift ;;
		-x|--extensions) EXTENSIONS="$2"; shift ;;
		-c|--status-codes) STATUS_CODES="$2"; shift ;;
		dir) shift; dir_mode "$@"; break ;;
		vhost) shift; vhost_mode "$@"; break ;;
		dns) shift; dns_mode "$@"; break ;;
		-t|--threads) THREADS="$2"; shift ;;
		-w|--wordlist) WORDLIST="$2"; shift ;;
		--check) check ;;
		*) error "Unknown parameter passed: $1"; exit 1 ;;
	esac
	shift
done

